import{s as w}from"./index-DiZwQw_Q.js";import{_ as Q,u as R,j as W,o as X,c,d as n,w as t,e as o,N as Y,b as a,S as F,a1 as Z,t as r,H as L,k as z,r as i,U as I,f as p,B as m,i as u,F as ee,z as ae,s as P,C as se,D as $,a6 as le,x as te,y as b,l as ne,P as oe,v as ie}from"./index-9-2YgmGC.js";const re={class:"spec-manage-container"},ue={class:"flex items-center gap-4 mt-4 mb-4"},de={class:"text-gray-400 text-sm"},fe={key:0,class:"text-center py-16 text-gray-400"},ve={key:1,class:"spec-grid"},ce={class:"spec-card-header"},pe={class:"spec-meta"},me=["title"],ge={class:"spec-service"},we={class:"spec-card-body"},ye={class:"spec-stat-row"},xe={class:"spec-stat"},_e={class:"spec-stat-value"},ke={class:"spec-stat"},be={class:"spec-stat-value"},Ce={key:0,class:"spec-warning"},Ne={class:"spec-time"},he={class:"spec-card-footer"},Me={class:"flex justify-end gap-2"},De={key:0},Se={class:"text-xs text-gray-400 break-all"},Te={class:"markdown-raw"},Ue={__name:"ApiSpecManage",setup(Be){const d=R(),E=W(),y=i(!1),C=i([]),x=i(""),_=i(null),g=i(!1),N=i(!1),f=i({serviceName:"",file:null}),h=i(!1),M=i(!1),v=i(null),D=i(!1),S=i(!1),T=i(""),O=I(()=>[...new Set(C.value.map(e=>e.service_name).filter(Boolean))].map(e=>({label:e,value:e}))),U=I(()=>{let s=C.value;if(_.value&&(s=s.filter(e=>e.service_name===_.value)),x.value){const e=x.value.toLowerCase();s=s.filter(l=>l.original_filename.toLowerCase().includes(e))}return s}),A=[{title:"Method",key:"method",width:90,render(s){return oe(ie,{type:{GET:"success",POST:"warning",PUT:"info",DELETE:"error",PATCH:"default"}[s.method]||"default",size:"small"},{default:()=>s.method})}},{title:"Path",key:"path",ellipsis:{tooltip:!0}},{title:"Summary",key:"summary",ellipsis:{tooltip:!0}}],B=async()=>{y.value=!0;try{const s=await w.getList({limit:200});s.success&&(C.value=s.data)}catch{d.error("加载失败")}finally{y.value=!1}},V=({fileList:s})=>{f.value.file=s.length>0?s[0].file:null},q=async()=>{var s,e;if(f.value.file){N.value=!0;try{const l=await w.importMd(f.value.file,f.value.serviceName||void 0);l.success?(d.success(`上传成功，解析出 ${l.data.endpoint_count} 个接口`),g.value=!1,f.value={serviceName:"",file:null},await B()):d.error(l.message||"上传失败")}catch(l){const k=((e=(s=l.response)==null?void 0:s.data)==null?void 0:e.detail)||l.message||"上传失败";d.error(k)}finally{N.value=!1}}},j=async s=>{h.value=!0,M.value=!0;try{const e=await w.getDetail(s.id);e.success&&(v.value=e.data)}catch{d.error("获取详情失败")}finally{M.value=!1}},H=async s=>{D.value=!0,S.value=!0,T.value="";try{const e=await w.getContent(s.id);e.success&&(T.value=e.data.content)}catch{d.error("获取原文失败")}finally{S.value=!1}},K=s=>{E.warning({title:"确认删除",content:`确定删除 "${s.original_filename}" 吗？MinIO 中的文件也会被删除。`,positiveText:"删除",negativeText:"取消",onPositiveClick:async()=>{try{(await w.delete(s.id)).success&&(d.success("删除成功"),await B())}catch{d.error("删除失败")}}})},G=s=>s?s<1024?s+"B":s<1024*1024?(s/1024).toFixed(1)+"KB":(s/1024/1024).toFixed(1)+"MB":"0B",J=s=>s?new Date(s).toLocaleString():"-";return X(B),(s,e)=>(p(),c("div",re,[n(o(Y),null,{header:t(()=>[...e[8]||(e[8]=[a("div",{class:"flex items-center gap-2"},[a("i",{class:"fas fa-file-code text-xl",style:{color:"#007857"}}),a("span",{class:"text-lg font-bold"},"接口文件管理")],-1)])]),"header-extra":t(()=>[n(o(m),{type:"primary",onClick:e[0]||(e[0]=l=>g.value=!0)},{icon:t(()=>[...e[9]||(e[9]=[a("i",{class:"fas fa-cloud-upload-alt"},null,-1)])]),default:t(()=>[e[10]||(e[10]=u(" 上传接口文件 ",-1))]),_:1})]),default:t(()=>[e[11]||(e[11]=a("p",{class:"text-gray-500"},"管理上传到 MinIO 的 Markdown 接口文档，系统自动解析接口信息用于智能匹配",-1))]),_:1}),a("div",ue,[n(o(F),{value:x.value,"onUpdate:value":e[1]||(e[1]=l=>x.value=l),placeholder:"搜索文件名...",clearable:"",style:{width:"280px"}},{prefix:t(()=>[...e[12]||(e[12]=[a("i",{class:"fas fa-search text-gray-400"},null,-1)])]),_:1},8,["value"]),n(o(Z),{value:_.value,"onUpdate:value":e[2]||(e[2]=l=>_.value=l),options:O.value,clearable:"",placeholder:"按服务筛选",style:{width:"180px"}},null,8,["value","options"]),e[13]||(e[13]=a("div",{class:"flex-1"},null,-1)),a("span",de,"共 "+r(U.value.length)+" 个文件",1)]),n(o(L),{show:y.value},{default:t(()=>[U.value.length===0&&!y.value?(p(),c("div",fe,[...e[14]||(e[14]=[a("i",{class:"fas fa-inbox text-5xl mb-4 block"},null,-1),a("p",null,"暂无接口文件，点击右上角上传",-1)])])):(p(),c("div",ve,[(p(!0),c(ee,null,ae(U.value,l=>(p(),c("div",{key:l.id,class:"spec-card"},[a("div",ce,[e[15]||(e[15]=a("div",{class:"spec-icon"},[a("i",{class:"fas fa-file-alt"})],-1)),a("div",pe,[a("h4",{class:"spec-filename",title:l.original_filename},r(l.original_filename),9,me),a("span",ge,r(l.service_name||"default"),1)])]),a("div",we,[a("div",ye,[a("div",xe,[a("span",_e,r(l.endpoint_count),1),e[16]||(e[16]=a("span",{class:"spec-stat-label"},"接口数",-1))]),a("div",ke,[a("span",be,r(G(l.file_size)),1),e[17]||(e[17]=a("span",{class:"spec-stat-label"},"文件大小",-1))])]),l.parse_warnings&&l.parse_warnings.length>0?(p(),c("div",Ce,[e[18]||(e[18]=a("i",{class:"fas fa-exclamation-triangle"},null,-1)),u(" "+r(l.parse_warnings[0]),1)])):P("",!0),a("p",Ne,r(J(l.created_at)),1)]),a("div",he,[n(o(m),{size:"small",quaternary:"",onClick:k=>j(l)},{icon:t(()=>[...e[19]||(e[19]=[a("i",{class:"fas fa-eye"},null,-1)])]),default:t(()=>[e[20]||(e[20]=u(" 查看 ",-1))]),_:1},8,["onClick"]),n(o(m),{size:"small",quaternary:"",onClick:k=>H(l)},{icon:t(()=>[...e[21]||(e[21]=[a("i",{class:"fas fa-code"},null,-1)])]),default:t(()=>[e[22]||(e[22]=u(" 原文 ",-1))]),_:1},8,["onClick"]),n(o(m),{size:"small",quaternary:"",type:"error",onClick:k=>K(l)},{icon:t(()=>[...e[23]||(e[23]=[a("i",{class:"fas fa-trash"},null,-1)])]),default:t(()=>[e[24]||(e[24]=u(" 删除 ",-1))]),_:1},8,["onClick"])])]))),128))]))]),_:1},8,["show"]),n(o(z),{show:g.value,"onUpdate:show":e[5]||(e[5]=l=>g.value=l),preset:"card",title:"上传接口文件",style:{width:"520px"}},{footer:t(()=>[a("div",Me,[n(o(m),{onClick:e[4]||(e[4]=l=>g.value=!1)},{default:t(()=>[...e[27]||(e[27]=[u("取消",-1)])]),_:1}),n(o(m),{type:"primary",loading:N.value,disabled:!f.value.file,onClick:q},{icon:t(()=>[...e[28]||(e[28]=[a("i",{class:"fas fa-upload"},null,-1)])]),default:t(()=>[e[29]||(e[29]=u(" 上传并解析 ",-1))]),_:1},8,["loading","disabled"])])]),default:t(()=>[n(o(se),{"label-placement":"left","label-width":"80"},{default:t(()=>[n(o($),{label:"服务名称"},{default:t(()=>[n(o(F),{value:f.value.serviceName,"onUpdate:value":e[3]||(e[3]=l=>f.value.serviceName=l),placeholder:"可选，用于分组管理"},null,8,["value"])]),_:1}),n(o($),{label:"Markdown"},{default:t(()=>[n(o(le),{max:1,accept:".md","default-upload":!1,onChange:V},{default:t(()=>[n(o(m),null,{icon:t(()=>[...e[25]||(e[25]=[a("i",{class:"fas fa-paperclip"},null,-1)])]),default:t(()=>[e[26]||(e[26]=u(" 选择 .md 文件 ",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"]),n(o(z),{show:h.value,"onUpdate:show":e[6]||(e[6]=l=>h.value=l),preset:"card",title:"接口文件详情",style:{width:"800px"}},{default:t(()=>[n(o(L),{show:M.value},{default:t(()=>[v.value?(p(),c("div",De,[n(o(te),{column:2,"label-placement":"left",bordered:"",size:"small",class:"mb-4"},{default:t(()=>[n(o(b),{label:"文件名"},{default:t(()=>[u(r(v.value.original_filename),1)]),_:1}),n(o(b),{label:"服务"},{default:t(()=>[u(r(v.value.service_name||"default"),1)]),_:1}),n(o(b),{label:"接口数"},{default:t(()=>[u(r(v.value.endpoint_count),1)]),_:1}),n(o(b),{label:"MinIO Key"},{default:t(()=>[a("span",Se,r(v.value.minio_key),1)]),_:1})]),_:1}),e[30]||(e[30]=a("h4",{class:"font-bold mb-2"},"接口列表",-1)),n(o(ne),{columns:A,data:v.value.endpoints||[],"max-height":360,size:"small",striped:""},null,8,["data"])])):P("",!0)]),_:1},8,["show"])]),_:1},8,["show"]),n(o(z),{show:D.value,"onUpdate:show":e[7]||(e[7]=l=>D.value=l),preset:"card",title:"Markdown 原文",style:{width:"800px"}},{default:t(()=>[n(o(L),{show:S.value},{default:t(()=>[a("div",Te,[a("pre",null,r(T.value),1)])]),_:1},8,["show"])]),_:1},8,["show"])]))}},Fe=Q(Ue,[["__scopeId","data-v-a7775bc8"]]);export{Fe as default};
