import{t as U}from"./index-DiZwQw_Q.js";import{u as pe}from"./useLazyLoad-CF_UHKIQ.js";import{_ as ve,u as fe,j as ye,c as h,d as t,w as r,e as l,N as P,k as B,r as C,f as b,b as v,C as M,D as d,S as g,a1 as z,l as ge,m as me,n as V,p as $,B as m,i as o,q as L,x as ce,y as f,t as p,F as O,z as R,s as j,O as E,P as c,v as be}from"./index-9-2YgmGC.js";const ke={class:"case-manage-view"},xe={style:{"margin-top":"20px",display:"flex","justify-content":"flex-end"}},we={style:{width:"100%"}},Ce={__name:"CaseManage",setup(he){const k=fe(),A=ye(),y=E({module:"",search:"",priority:null,case_type:null}),{data:G,loading:H,currentPage:N,pageSize:_,total:J,refresh:T,goToPage:K,changePageSize:Q}=pe({fetchFunction:U.getList,pageSize:10,filters:y,autoLoad:!0,debounceDelay:500}),W=[{label:"全部",value:null},{label:"1级",value:"1"},{label:"2级",value:"2"},{label:"3级",value:"3"},{label:"4级",value:"4"}],X=[{label:"1级 - 最高",value:"1"},{label:"2级 - 高",value:"2"},{label:"3级 - 中",value:"3"},{label:"4级 - 低",value:"4"}],Y=[{label:"功能测试",value:"功能测试"},{label:"冒烟测试",value:"冒烟测试"},{label:"回归测试",value:"回归测试"},{label:"边界测试",value:"边界测试"},{label:"异常测试",value:"异常测试"}],Z=[{label:"开发阶段",value:"开发阶段"},{label:"测试阶段",value:"测试阶段"},{label:"验收阶段",value:"验收阶段"},{label:"上线阶段",value:"上线阶段"}],D=C(!1),u=C(null),x=C(!1),w=C(!1),S=C(!1),F=C(null),a=E({id:null,module:"",title:"",precondition:"",steps:[""],expected:"",keywords:"",priority:"2",case_type:"功能测试",stage:"测试阶段"}),ee={module:{required:!0,message:"请输入模块名称",trigger:"blur"},title:{required:!0,message:"请输入用例名称",trigger:"blur"},steps:{required:!0,validator:(i,e)=>!e||e.length===0||e.every(s=>!s.trim())?new Error("请至少输入一个测试步骤"):!0,trigger:"blur"},expected:{required:!0,message:"请输入预期结果",trigger:"blur"},priority:{required:!0,message:"请选择优先级",trigger:"change"}},le=i=>({1:"error",2:"warning",3:"info",4:"default"})[String(i)]||"default",I=i=>/^[1-4]$/.test(String(i))?`${i}级`:i,te=[{title:"ID",key:"id",width:80},{title:"模块",key:"module",width:120},{title:"用例名称",key:"title",width:200,ellipsis:{tooltip:!0}},{title:"步骤",key:"steps",render(i){const e=i.steps||[];return e.length===0?"-":c("div",{},e.slice(0,3).map((s,n)=>c("div",{style:"margin: 2px 0; font-size: 12px;"},`${n+1}. ${s}`)).concat(e.length>3?[c("div",{style:"font-size: 12px; color: #999;"},`...共${e.length}步`)]:[]))}},{title:"优先级",key:"priority",width:80,render(i){return c(be,{type:le(i.priority),size:"small"},{default:()=>I(i.priority)})}},{title:"用例类型",key:"case_type",width:100},{title:"操作",key:"actions",width:220,fixed:"right",render(i){return c($,{},{default:()=>[c(m,{size:"small",type:"info",onClick:()=>ae(i)},{default:()=>"详情"}),c(m,{size:"small",type:"primary",onClick:()=>re(i)},{default:()=>"编辑"}),c(m,{size:"small",type:"error",onClick:()=>de(i)},{default:()=>"删除"})]})}}],ae=i=>{u.value=i,D.value=!0},se=()=>{w.value=!1,ie(),x.value=!0},re=i=>{w.value=!0,a.id=i.id,a.module=i.module||"",a.title=i.title||"",a.precondition=i.precondition||"",a.steps=i.steps&&i.steps.length>0?[...i.steps]:[""],a.expected=i.expected||"",a.keywords=i.keywords||"",a.priority=String(i.priority||"2"),a.case_type=i.case_type||"功能测试",a.stage=i.stage||"测试阶段",x.value=!0},ie=()=>{a.id=null,a.module="",a.title="",a.precondition="",a.steps=[""],a.expected="",a.keywords="",a.priority="2",a.case_type="功能测试",a.stage="测试阶段"},oe=()=>{a.steps.push("")},ue=i=>{a.steps.splice(i,1)},ne=async()=>{var i;try{await((i=F.value)==null?void 0:i.validate())}catch{return}S.value=!0;try{const e={...a,steps:a.steps.filter(n=>n.trim())};let s;w.value?s=await U.update(a.id,e):s=await U.create(e),s.success?(k.success(w.value?"更新成功":"创建成功"),x.value=!1,T()):k.error(s.message||"操作失败")}catch(e){k.error("操作失败: "+(e.message||"未知错误")),console.error(e)}finally{S.value=!1}},de=i=>{A.warning({title:"确认删除",content:`确定要删除用例 "${i.title}" 吗？`,positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{const e=await U.delete(i.id);e.success?(k.success("删除成功"),T()):k.error(e.message||"删除失败")}catch(e){k.error("删除失败: "+(e.message||"未知错误")),console.error(e)}}})};return(i,e)=>(b(),h("div",ke,[t(l(P),null,{header:r(()=>[...e[16]||(e[16]=[v("div",{class:"flex items-center gap-2"},[v("i",{class:"fas fa-list-check text-xl text-primary"}),v("span",{class:"text-lg font-bold"},"用例管理")],-1)])]),default:r(()=>[e[17]||(e[17]=v("p",{class:"text-gray-500"}," 管理所有测试用例，支持增删改查操作 ",-1))]),_:1}),t(l(P),{style:{"margin-top":"20px"}},{default:r(()=>[t(l(M),{inline:"",model:y,"label-placement":"left"},{default:r(()=>[t(l(d),{label:"模块"},{default:r(()=>[t(l(g),{value:y.module,"onUpdate:value":e[0]||(e[0]=s=>y.module=s),placeholder:"筛选模块",clearable:"",style:{width:"150px"}},null,8,["value"])]),_:1}),t(l(d),{label:"关键词"},{default:r(()=>[t(l(g),{value:y.search,"onUpdate:value":e[1]||(e[1]=s=>y.search=s),placeholder:"搜索用例名称",clearable:"",style:{width:"200px"}},null,8,["value"])]),_:1}),t(l(d),{label:"优先级"},{default:r(()=>[t(l(z),{value:y.priority,"onUpdate:value":e[2]||(e[2]=s=>y.priority=s),options:W,clearable:"",placeholder:"全部",style:{width:"100px"}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1}),t(l(P),{style:{"margin-top":"20px"}},{header:r(()=>[...e[18]||(e[18]=[v("span",{class:"font-bold"},"测试用例列表",-1)])]),"header-extra":r(()=>[t(l($),null,{default:r(()=>[t(l(m),{type:"primary",onClick:se},{icon:r(()=>[...e[19]||(e[19]=[v("i",{class:"fas fa-plus"},null,-1)])]),default:r(()=>[e[20]||(e[20]=o(" 新建用例 ",-1))]),_:1})]),_:1})]),default:r(()=>[t(l(ge),{columns:te,data:l(G),loading:l(H),"row-key":s=>s.id,striped:""},null,8,["data","loading","row-key"]),v("div",xe,[t(l(me),{page:l(N),"onUpdate:page":[e[3]||(e[3]=s=>V(N)?N.value=s:null),l(K)],"page-size":l(_),"onUpdate:pageSize":[e[4]||(e[4]=s=>V(_)?_.value=s:null),l(Q)],"item-count":l(J),"page-sizes":[10,20,50],"show-size-picker":""},null,8,["page","page-size","item-count","onUpdate:page","onUpdate:pageSize"])])]),_:1}),t(l(B),{show:D.value,"onUpdate:show":e[5]||(e[5]=s=>D.value=s),preset:"card",title:"测试用例详情",style:{width:"800px"}},{default:r(()=>[u.value?(b(),L(l(ce),{key:0,column:1,"label-placement":"left",bordered:""},{default:r(()=>[t(l(f),{label:"ID"},{default:r(()=>[o(p(u.value.id),1)]),_:1}),t(l(f),{label:"模块"},{default:r(()=>[o(p(u.value.module),1)]),_:1}),t(l(f),{label:"用例名称"},{default:r(()=>[o(p(u.value.title),1)]),_:1}),t(l(f),{label:"前置条件"},{default:r(()=>[o(p(u.value.precondition||"无"),1)]),_:1}),t(l(f),{label:"测试步骤"},{default:r(()=>[(b(!0),h(O,null,R(u.value.steps,(s,n)=>(b(),h("div",{key:n},p(n+1)+". "+p(s),1))),128))]),_:1}),t(l(f),{label:"预期结果"},{default:r(()=>[o(p(u.value.expected),1)]),_:1}),t(l(f),{label:"关键词"},{default:r(()=>[o(p(u.value.keywords),1)]),_:1}),t(l(f),{label:"优先级"},{default:r(()=>[o(p(I(u.value.priority)),1)]),_:1}),t(l(f),{label:"用例类型"},{default:r(()=>[o(p(u.value.case_type),1)]),_:1}),t(l(f),{label:"适用阶段"},{default:r(()=>[o(p(u.value.stage),1)]),_:1})]),_:1})):j("",!0)]),_:1},8,["show"]),t(l(B),{show:x.value,"onUpdate:show":e[15]||(e[15]=s=>x.value=s),preset:"card",title:w.value?"编辑用例":"新建用例",style:{width:"800px"}},{footer:r(()=>[t(l($),{justify:"end"},{default:r(()=>[t(l(m),{onClick:e[14]||(e[14]=s=>x.value=!1)},{default:r(()=>[...e[24]||(e[24]=[o("取消",-1)])]),_:1}),t(l(m),{type:"primary",onClick:ne,loading:S.value},{default:r(()=>[o(p(w.value?"保存":"创建"),1)]),_:1},8,["loading"])]),_:1})]),default:r(()=>[t(l(M),{ref_key:"formRef",ref:F,model:a,rules:ee,"label-placement":"left","label-width":"100"},{default:r(()=>[t(l(d),{label:"模块",path:"module"},{default:r(()=>[t(l(g),{value:a.module,"onUpdate:value":e[6]||(e[6]=s=>a.module=s),placeholder:"请输入模块名称"},null,8,["value"])]),_:1}),t(l(d),{label:"用例名称",path:"title"},{default:r(()=>[t(l(g),{value:a.title,"onUpdate:value":e[7]||(e[7]=s=>a.title=s),placeholder:"请输入用例名称"},null,8,["value"])]),_:1}),t(l(d),{label:"前置条件",path:"precondition"},{default:r(()=>[t(l(g),{value:a.precondition,"onUpdate:value":e[8]||(e[8]=s=>a.precondition=s),type:"textarea",placeholder:"请输入前置条件（可选）",rows:2},null,8,["value"])]),_:1}),t(l(d),{label:"测试步骤",path:"steps"},{default:r(()=>[v("div",we,[(b(!0),h(O,null,R(a.steps,(s,n)=>(b(),h("div",{key:n,class:"step-item"},[t(l(g),{value:a.steps[n],"onUpdate:value":q=>a.steps[n]=q,placeholder:`步骤 ${n+1}`},null,8,["value","onUpdate:value","placeholder"]),a.steps.length>1?(b(),L(l(m),{key:0,type:"error",text:"",onClick:q=>ue(n)},{default:r(()=>[...e[21]||(e[21]=[v("i",{class:"fas fa-times"},null,-1)])]),_:1},8,["onClick"])):j("",!0)]))),128)),t(l(m),{dashed:"",block:"",onClick:oe,style:{"margin-top":"8px"}},{icon:r(()=>[...e[22]||(e[22]=[v("i",{class:"fas fa-plus"},null,-1)])]),default:r(()=>[e[23]||(e[23]=o(" 添加步骤 ",-1))]),_:1})])]),_:1}),t(l(d),{label:"预期结果",path:"expected"},{default:r(()=>[t(l(g),{value:a.expected,"onUpdate:value":e[9]||(e[9]=s=>a.expected=s),type:"textarea",placeholder:"请输入预期结果",rows:2},null,8,["value"])]),_:1}),t(l(d),{label:"关键词",path:"keywords"},{default:r(()=>[t(l(g),{value:a.keywords,"onUpdate:value":e[10]||(e[10]=s=>a.keywords=s),placeholder:"请输入关键词，用逗号分隔"},null,8,["value"])]),_:1}),t(l(d),{label:"优先级",path:"priority"},{default:r(()=>[t(l(z),{value:a.priority,"onUpdate:value":e[11]||(e[11]=s=>a.priority=s),options:X,placeholder:"请选择优先级"},null,8,["value"])]),_:1}),t(l(d),{label:"用例类型",path:"case_type"},{default:r(()=>[t(l(z),{value:a.case_type,"onUpdate:value":e[12]||(e[12]=s=>a.case_type=s),options:Y,placeholder:"请选择用例类型"},null,8,["value"])]),_:1}),t(l(d),{label:"适用阶段",path:"stage"},{default:r(()=>[t(l(z),{value:a.stage,"onUpdate:value":e[13]||(e[13]=s=>a.stage=s),options:Z,placeholder:"请选择适用阶段"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])]))}},_e=ve(Ce,[["__scopeId","data-v-1dcf9f21"]]);export{_e as default};
