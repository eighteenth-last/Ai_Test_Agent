import{h as L}from"./index-DiZwQw_Q.js";import{u as se}from"./useLazyLoad-CF_UHKIQ.js";import{_ as ae,u as le,c as m,d as r,w as l,e as a,N as k,k as ne,r as I,f,b as n,p as O,a1 as re,S as oe,aa as ie,l as ue,m as de,n as B,H as pe,x as fe,y as w,i as g,t as c,v as S,q as h,I as ce,s as x,J as ye,F as P,z as T,K as me,L as ge,M as A,ab as _e,B as R,O as ve,P as b}from"./index-9-2YgmGC.js";const xe={class:"run-report-view"},be={class:"filter-item"},ke={class:"filter-item",style:{flex:"1","min-width":"280px","max-width":"400px"}},we={class:"filter-item"},Ne={style:{"margin-top":"20px",display:"flex","justify-content":"flex-end"}},Se={key:0},he={class:"flex items-center justify-between"},Re=["href"],ze={key:1,class:"text-gray-400"},Le={class:"step-detail"},Oe={key:0},De={class:"thinking-text"},Ue={key:1},je=["href"],Ie={key:2},Je={key:3,class:"timestamp"},Ce={class:"json-output"},Be={key:0},Pe={class:"json-output"},Te={__name:"RunReport",setup(Ae){const _=le(),J=s=>s?new Date(s).toISOString().split("T")[0]:null,F=async s=>{const e={...s};e.dateRange&&e.dateRange.length===2&&(e.start_date=J(e.dateRange[0]),e.end_date=J(e.dateRange[1]),delete e.dateRange);const t=await L.getList(e);return t.success?{success:!0,data:(t.data||[]).map(o=>{let i={};try{i=typeof o.summary=="string"?JSON.parse(o.summary):o.summary}catch(y){console.error("Failed to parse summary:",y)}let p="fail";i.status?i.status==="é€šè¿‡"||i.status==="pass"?p="pass":(i.status==="å¤±è´¥"||i.status==="fail")&&(p="fail"):i.total!==void 0&&(i.fail===0&&i.total>0?p="pass":p="fail");let N=o.total_steps||i.total_steps||0;if(!N&&o.execution_log)try{const y=typeof o.execution_log=="string"?JSON.parse(o.execution_log):o.execution_log;y&&(y.steps&&Array.isArray(y.steps)?N=y.steps.length:y.total_steps?N=y.total_steps:y.step_count&&(N=y.step_count))}catch(y){console.error("Failed to parse execution_log for steps:",y)}return{...o,status:p,duration:i.duration||0,total_steps:N,case_name:o.title||"-",case_type:o.case_type||"åŠŸèƒ½æµ‹è¯•",execution_mode:o.execution_mode||i.execution_mode||"å•é‡"}}),total:t.total}:t},v=ve({status:null,search:"",dateRange:null}),{data:E,loading:M,currentPage:D,pageSize:U,total:V,refresh:$,goToPage:q,changePageSize:H}=se({fetchFunction:F,pageSize:10,filters:v,autoLoad:!0,debounceDelay:500}),C=s=>{typeof s=="number"?q(s):$()},K=[{label:"å…¨éƒ¨",value:null},{label:"é€šè¿‡",value:"pass"},{label:"å¤±è´¥",value:"fail"}],z=I(!1),j=I(!1),u=I(null),W=s=>s==="pass"?"success":"error",G=s=>s==="pass"?"é€šè¿‡":"å¤±è´¥",Q=s=>{if(!s)return"æš‚æ— æ•°æ®";try{const e=typeof s=="string"?JSON.parse(s):s;return JSON.stringify(e,null,2)}catch{return s}},X=[{title:"ID",key:"id",width:80},{title:"æµ‹è¯•ç”¨ä¾‹",key:"case_name",width:350,ellipsis:{tooltip:!0}},{title:"æµ‹è¯•ç±»åž‹",key:"case_type",width:120,render(s){const e=s.case_type||"åŠŸèƒ½æµ‹è¯•";return b(S,{type:{åŠŸèƒ½æµ‹è¯•:"info",æŽ¥å£æµ‹è¯•:"warning",å•å…ƒæµ‹è¯•:"success",æ€§èƒ½æµ‹è¯•:"error",å®‰å…¨æµ‹è¯•:"error"}[e]||"default",size:"small"},{default:()=>e})}},{title:"æ‰§è¡Œæ¨¡å¼",key:"execution_mode",width:100,render(s){const e=s.execution_mode||"å•é‡";return b(S,{type:e==="æ‰¹é‡"?"warning":"default",size:"small"},{default:()=>e})}},{title:"çŠ¶æ€",key:"status",width:100,render(s){return b(S,{type:W(s.status),size:"small"},{default:()=>G(s.status)})}},{title:"æ‰§è¡Œæ—¶é—´",key:"created_at",width:200,render(s){if(!s.created_at)return"-";try{return new Date(s.created_at).toLocaleString()}catch{return s.created_at}}},{title:"æ“ä½œ",key:"actions",width:220,fixed:"right",render(s){return b(O,{},{default:()=>[b(R,{size:"small",type:"primary",onClick:()=>Y(s)},{default:()=>"æŸ¥çœ‹è¯¦æƒ…"}),b(R,{size:"small",type:"info",onClick:()=>ee(s)},{default:()=>"ä¸‹è½½"}),b(R,{size:"small",type:"error",onClick:()=>te(s)},{default:()=>"åˆ é™¤"})]})}}],Y=async s=>{z.value=!0,j.value=!0;try{const e=await L.getById(s.id);if(e.success){const t=e.data;let d={};try{d=typeof t.summary=="string"?JSON.parse(t.summary):t.summary}catch(p){console.error("Failed to parse summary:",p)}let o=t.total_steps||d.total_steps||0;if(!o&&t.execution_log)try{const p=typeof t.execution_log=="string"?JSON.parse(t.execution_log):t.execution_log;p.steps&&Array.isArray(p.steps)?o=p.steps.length:p.total_steps?o=p.total_steps:p.step_count&&(o=p.step_count)}catch(p){console.error("Failed to parse execution_log:",p)}let i="fail";d.status?d.status==="é€šè¿‡"||d.status==="pass"?i="pass":(d.status==="å¤±è´¥"||d.status==="fail")&&(i="fail"):d.total!==void 0&&(d.fail===0&&d.total>0?i="pass":i="fail"),u.value={...t,status:i,duration:d.duration||0,total_steps:o,case_name:t.title||"-"}}else _.error("èŽ·å–æŠ¥å‘Šè¯¦æƒ…å¤±è´¥")}catch(e){_.error("èŽ·å–æŠ¥å‘Šè¯¦æƒ…å¤±è´¥"),console.error(e)}finally{j.value=!1}},Z=()=>{if(!u.value)return;const s=JSON.stringify(u.value,null,2),e=new Blob([s],{type:"application/json"}),t=URL.createObjectURL(e),d=document.createElement("a");d.href=t,d.download=`test_report_${u.value.id}.json`,d.click(),URL.revokeObjectURL(t),_.success("æŠ¥å‘Šä¸‹è½½æˆåŠŸ")},ee=async s=>{try{const e=await L.getById(s.id);if(e.success){const t=JSON.stringify(e.data,null,2),d=new Blob([t],{type:"application/json"}),o=URL.createObjectURL(d),i=document.createElement("a");i.href=o,i.download=`test_report_${s.id}.json`,i.click(),URL.revokeObjectURL(o),_.success("æŠ¥å‘Šä¸‹è½½æˆåŠŸ")}}catch(e){_.error("ä¸‹è½½å¤±è´¥"),console.error(e)}},te=async s=>{try{const e=await L.delete(s.id);e.success?(_.success("åˆ é™¤æˆåŠŸ"),C()):_.error(e.message||"åˆ é™¤å¤±è´¥")}catch(e){_.error("åˆ é™¤å¤±è´¥"),console.error(e)}};return(s,e)=>(f(),m("div",xe,[r(a(k),null,{header:l(()=>[...e[7]||(e[7]=[n("div",{class:"flex items-center gap-2"},[n("i",{class:"fas fa-file-alt text-xl text-primary"}),n("span",{class:"text-lg font-bold"},"æµ‹è¯•æŠ¥å‘Šç®¡ç†")],-1)])]),default:l(()=>[e[8]||(e[8]=n("p",{class:"text-gray-500"}," æŸ¥çœ‹å’Œç®¡ç†æ‰€æœ‰æµ‹è¯•æ‰§è¡Œçš„æŠ¥å‘Šï¼ŒåŒ…æ‹¬æ‰§è¡Œç»“æžœã€æ—¥å¿—è¯¦æƒ…ç­‰ ",-1))]),_:1}),r(a(k),{style:{"margin-top":"20px"}},{default:l(()=>[r(a(O),{vertical:"",size:12},{default:l(()=>[r(a(O),{align:"center",size:16,wrap:!1},{default:l(()=>[n("div",be,[e[9]||(e[9]=n("span",{class:"filter-label"},"çŠ¶æ€",-1)),r(a(re),{value:v.status,"onUpdate:value":e[0]||(e[0]=t=>v.status=t),options:K,clearable:"",placeholder:"å…¨éƒ¨",style:{width:"140px"}},null,8,["value"])]),n("div",ke,[e[11]||(e[11]=n("span",{class:"filter-label"},"æµ‹è¯•åç§°",-1)),r(a(oe),{value:v.search,"onUpdate:value":e[1]||(e[1]=t=>v.search=t),placeholder:"æœç´¢æµ‹è¯•ç”¨ä¾‹åç§°",clearable:""},{prefix:l(()=>[...e[10]||(e[10]=[n("i",{class:"fas fa-search text-gray-400"},null,-1)])]),_:1},8,["value"])]),n("div",we,[e[12]||(e[12]=n("span",{class:"filter-label"},"æ—¥æœŸèŒƒå›´",-1)),r(a(ie),{value:v.dateRange,"onUpdate:value":e[2]||(e[2]=t=>v.dateRange=t),type:"daterange",clearable:"","start-placeholder":"Start Date","end-placeholder":"End Date",style:{width:"320px"}},null,8,["value"])])]),_:1})]),_:1})]),_:1}),r(a(k),{style:{"margin-top":"20px"}},{header:l(()=>[...e[13]||(e[13]=[n("span",{class:"font-bold"},"æŠ¥å‘Šåˆ—è¡¨",-1)])]),default:l(()=>[r(a(ue),{columns:X,data:a(E),loading:a(M),"row-key":t=>t.id,striped:""},null,8,["data","loading","row-key"]),n("div",Ne,[r(a(de),{page:a(D),"onUpdate:page":[e[3]||(e[3]=t=>B(D)?D.value=t:null),C],"page-size":a(U),"onUpdate:pageSize":[e[4]||(e[4]=t=>B(U)?U.value=t:null),a(H)],"item-count":a(V),"page-sizes":[10,20,50],"show-size-picker":""},null,8,["page","page-size","item-count","onUpdate:pageSize"])])]),_:1}),r(a(ne),{show:z.value,"onUpdate:show":e[6]||(e[6]=t=>z.value=t),preset:"card",title:"æµ‹è¯•æŠ¥å‘Šè¯¦æƒ…",style:{width:"900px"}},{footer:l(()=>[r(a(O),{justify:"end"},{default:l(()=>[r(a(R),{type:"primary",onClick:Z},{icon:l(()=>[...e[24]||(e[24]=[n("i",{class:"fas fa-download"},null,-1)])]),default:l(()=>[e[25]||(e[25]=g(" ä¸‹è½½æŠ¥å‘Š ",-1))]),_:1}),r(a(R),{onClick:e[5]||(e[5]=t=>z.value=!1)},{default:l(()=>[...e[26]||(e[26]=[g("å…³é—­",-1)])]),_:1})]),_:1})]),default:l(()=>[r(a(pe),{show:j.value},{default:l(()=>[u.value?(f(),m("div",Se,[r(a(k),{size:"small",style:{"margin-bottom":"20px"}},{header:l(()=>[n("div",he,[e[14]||(e[14]=n("span",null,[n("strong",null,"åŸºæœ¬ä¿¡æ¯")],-1)),r(a(S),{type:u.value.status==="pass"?"success":"error"},{default:l(()=>[g(c(u.value.status==="pass"?"é€šè¿‡":"å¤±è´¥"),1)]),_:1},8,["type"])])]),default:l(()=>[r(a(fe),{column:2,"label-placement":"left",bordered:""},{default:l(()=>[r(a(w),{label:"æŠ¥å‘ŠID"},{default:l(()=>[g(c(u.value.id),1)]),_:1}),r(a(w),{label:"æµ‹è¯•ç”¨ä¾‹"},{default:l(()=>[g(c(u.value.case_name),1)]),_:1}),r(a(w),{label:"æ‰§è¡Œæ—¶é—´"},{default:l(()=>[g(c(u.value.created_at),1)]),_:1}),r(a(w),{label:"è€—æ—¶"},{default:l(()=>[g(c(u.value.duration)+" ç§’",1)]),_:1}),r(a(w),{label:"æ€»æ­¥æ•°"},{default:l(()=>[g(c(u.value.total_steps),1)]),_:1}),r(a(w),{label:"æœ€ç»ˆURL"},{default:l(()=>[u.value.final_url?(f(),m("a",{key:0,href:u.value.final_url,target:"_blank",class:"url-link"},c(u.value.final_url),9,Re)):(f(),m("span",ze,"-"))]),_:1})]),_:1})]),_:1}),u.value.error_message?(f(),h(a(ce),{key:0,title:"é”™è¯¯ä¿¡æ¯",type:"error",style:{"margin-bottom":"20px"}},{default:l(()=>[g(c(u.value.error_message),1)]),_:1})):x("",!0),u.value.history?(f(),h(a(k),{key:1,size:"small",style:{"margin-bottom":"20px"}},{header:l(()=>[...e[15]||(e[15]=[n("strong",null,"æ‰§è¡Œæ­¥éª¤è¯¦æƒ…",-1)])]),default:l(()=>[r(a(ye),{accordion:""},{default:l(()=>[(f(!0),m(P,null,T(u.value.history.steps||[],(t,d)=>(f(),h(a(me),{key:d,title:`æ­¥éª¤ ${t.step_number||d+1} - ${t.title||t.url||"æ‰§è¡Œä¸­"}`,name:d},{default:l(()=>[n("div",Le,[t.thinking?(f(),m("p",Oe,[e[16]||(e[16]=n("strong",null,"ðŸ’­ AI æ€è€ƒ:",-1)),e[17]||(e[17]=n("br",null,null,-1)),n("span",De,c(t.thinking),1)])):x("",!0),t.url?(f(),m("p",Ue,[e[18]||(e[18]=n("strong",null,"ðŸŒ é¡µé¢:",-1)),n("a",{href:t.url,target:"_blank",class:"url-link"},c(t.url),9,je)])):x("",!0),t.actions&&t.actions.length>0?(f(),m("p",Ie,[e[19]||(e[19]=n("strong",null,"âš¡ æ‰§è¡ŒåŠ¨ä½œ:",-1)),e[20]||(e[20]=n("br",null,null,-1)),(f(!0),m(P,null,T(t.actions,(o,i)=>(f(),h(a(S),{key:i,size:"small",style:{margin:"4px 4px 0 0"}},{default:l(()=>[g(c(o.action_name||o),1)]),_:2},1024))),128))])):x("",!0),t.timestamp?(f(),m("p",Je,[e[21]||(e[21]=n("strong",null,"â° æ—¶é—´:",-1)),g(" "+c(t.timestamp),1)])):x("",!0)])]),_:2},1032,["title","name"]))),128))]),_:1})]),_:1})):x("",!0),r(a(k),{size:"small"},{header:l(()=>[...e[22]||(e[22]=[n("strong",null,"åŽŸå§‹æ•°æ®",-1)])]),default:l(()=>[r(a(ge),{type:"line"},{default:l(()=>[r(a(A),{name:"history",tab:"æ‰§è¡ŒåŽ†å² JSON"},{default:l(()=>[n("div",Ce,[u.value.execution_log?(f(),m("pre",Be,c(Q(u.value.execution_log)),1)):(f(),h(a(_e),{key:1,description:"æš‚æ— æ‰§è¡ŒåŽ†å²æ•°æ®",size:"small"},{icon:l(()=>[...e[23]||(e[23]=[n("i",{class:"fas fa-info-circle text-slate-400"},null,-1)])]),_:1}))])]),_:1}),r(a(A),{name:"raw",tab:"å®Œæ•´æŠ¥å‘Š JSON"},{default:l(()=>[n("div",Pe,[n("pre",null,c(JSON.stringify(u.value,null,2)),1)])]),_:1})]),_:1})]),_:1})])):x("",!0)]),_:1},8,["show"])]),_:1},8,["show"])]))}},Ve=ae(Te,[["__scopeId","data-v-f5ea9caa"]]);export{Ve as default};
