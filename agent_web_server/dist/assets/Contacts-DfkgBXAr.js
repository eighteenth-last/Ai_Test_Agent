import{c}from"./index-DiZwQw_Q.js";import{_ as h,u as j,j as A,o as P,c as q,b as i,d as t,w as u,e as o,S as w,B as p,l as z,k as E,r as v,U as k,f as F,i as x,C as $,D as b,a1 as G,E as N,P as f,v as O,p as H}from"./index-9-2YgmGC.js";const J={class:"glass-card overflow-hidden"},K={class:"p-6 border-b border-slate-100 flex justify-between items-center"},Q={class:"flex gap-2"},W={class:"flex justify-end gap-2"},U=10,X={__name:"Contacts",setup(Y){const r=j(),R=A(),m=v(""),d=v(!1),n=v(null),g=v(!1),l=v({name:"",email:"",role:"开发人员",autoReceive:!0}),B=[{label:"后端开发",value:"后端开发"},{label:"前端开发",value:"前端开发"},{label:"测试负责人",value:"测试负责人"},{label:"项目经理",value:"项目经理"},{label:"开发人员",value:"开发人员"}],T={后端开发:{label:"后端开发",type:"info"},前端开发:{label:"前端开发",type:"success"},测试负责人:{label:"测试负责人",type:"warning"},项目经理:{label:"项目经理",type:"error"},开发人员:{label:"开发人员",type:"default"}},y=v([]),_=k(()=>{if(!m.value)return y.value;const e=m.value.toLowerCase();return y.value.filter(a=>a.name.toLowerCase().includes(e)||a.email.toLowerCase().includes(e))}),M=[{title:"姓名",key:"name",width:120},{title:"邮箱",key:"email"},{title:"角色",key:"role",render(e){const a=T[e.role]||{label:e.role,type:"default"};return f(O,{type:a.type,size:"small"},{default:()=>a.label})}},{title:"自动接收BUG",key:"auto_receive_bug",render(e){return f(N,{value:e.auto_receive_bug===1,onUpdateValue:async a=>{try{await c.update(e.id,{name:e.name,email:e.email,role:e.role,auto_receive_bug:a?1:0}),e.auto_receive_bug=a?1:0,r.success("更新成功")}catch{r.error("更新失败")}}})}},{title:"操作",key:"actions",render(e){return f(H,null,{default:()=>[f(p,{text:!0,type:"primary",onClick:()=>I(e)},{default:()=>"编辑"}),f(p,{text:!0,type:"error",onClick:()=>L(e)},{default:()=>"移除"})]})}}],S=k(()=>{const e=_.value.length;return!e||e<=U?!1:{pageSize:U}}),C=async()=>{g.value=!0;try{const e=await c.getList();y.value=e||[],console.log("联系人数据:",y.value)}catch(e){r.error("加载联系人列表失败"),console.error(e)}finally{g.value=!1}},D=()=>{n.value=null,l.value={name:"",email:"",role:"开发人员",autoReceive:!0},d.value=!0},I=e=>{n.value=e,l.value={name:e.name,email:e.email,role:e.role,autoReceive:e.auto_receive_bug===1},d.value=!0},L=e=>{R.warning({title:"确认删除",content:`确定要移除联系人 "${e.name}" 吗？`,positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{await c.delete(e.id),await C(),r.success("删除成功")}catch{r.error("删除失败")}}})},V=async()=>{if(!l.value.name||!l.value.email){r.error("请填写必填项");return}try{const e={name:l.value.name,email:l.value.email,role:l.value.role,auto_receive_bug:l.value.autoReceive?1:0};n.value?(await c.update(n.value.id,e),r.success("更新成功")):(await c.add(e),r.success("添加成功")),d.value=!1,n.value=null,l.value={name:"",email:"",role:"开发人员",autoReceive:!0},await C()}catch(e){r.error(n.value?"更新失败":"添加失败"),console.error(e)}};return P(()=>{C()}),(e,a)=>(F(),q("div",null,[i("div",J,[i("div",K,[a[10]||(a[10]=i("h3",{class:"font-bold"},"测试/开发联系人维护",-1)),i("div",Q,[t(o(w),{value:m.value,"onUpdate:value":a[0]||(a[0]=s=>m.value=s),placeholder:"搜索姓名/邮箱...",style:{width:"200px"}},{prefix:u(()=>[...a[7]||(a[7]=[i("i",{class:"fas fa-search text-slate-400"},null,-1)])]),_:1},8,["value"]),t(o(p),{type:"primary",onClick:D},{icon:u(()=>[...a[8]||(a[8]=[i("i",{class:"fas fa-plus"},null,-1)])]),default:u(()=>[a[9]||(a[9]=x(" 新增联系人 ",-1))]),_:1})])]),t(o(z),{columns:M,data:_.value,pagination:S.value,bordered:!1,loading:g.value},null,8,["data","pagination","loading"])]),t(o(E),{show:d.value,"onUpdate:show":a[6]||(a[6]=s=>d.value=s),preset:"card",title:n.value?"编辑联系人":"新增联系人",style:{width:"500px"}},{footer:u(()=>[i("div",W,[t(o(p),{onClick:a[5]||(a[5]=s=>d.value=!1)},{default:u(()=>[...a[11]||(a[11]=[x("取消",-1)])]),_:1}),t(o(p),{type:"primary",onClick:V},{default:u(()=>[...a[12]||(a[12]=[x("保存",-1)])]),_:1})])]),default:u(()=>[t(o($),{model:l.value,"label-placement":"left","label-width":"80"},{default:u(()=>[t(o(b),{label:"姓名",required:""},{default:u(()=>[t(o(w),{value:l.value.name,"onUpdate:value":a[1]||(a[1]=s=>l.value.name=s),placeholder:"请输入姓名"},null,8,["value"])]),_:1}),t(o(b),{label:"邮箱",required:""},{default:u(()=>[t(o(w),{value:l.value.email,"onUpdate:value":a[2]||(a[2]=s=>l.value.email=s),placeholder:"请输入邮箱"},null,8,["value"])]),_:1}),t(o(b),{label:"角色"},{default:u(()=>[t(o(G),{value:l.value.role,"onUpdate:value":a[3]||(a[3]=s=>l.value.role=s),options:B},null,8,["value"])]),_:1}),t(o(b),{label:"自动接收"},{default:u(()=>[t(o(N),{value:l.value.autoReceive,"onUpdate:value":a[4]||(a[4]=s=>l.value.autoReceive=s)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])]))}},ae=h(X,[["__scopeId","data-v-a9df69f8"]]);export{ae as default};
