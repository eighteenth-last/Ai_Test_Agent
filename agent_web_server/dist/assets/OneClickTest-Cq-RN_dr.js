import{u as R,o as G,c as n,b as s,V as O,d as u,w as a,e as d,B as _,F as j,z as N,t as c,s as w,T as W,v as T,H as X,W as Y,X as Z,S as J,q as Q,Y as ee,Z as se,r as b,U as te,f as o,i as v,$ as le,a0 as ae}from"./index-9-2YgmGC.js";import{o as C}from"./index-DiZwQw_Q.js";const oe={class:"flex flex-col h-full gap-4"},re={class:"bg-white rounded-2xl border border-slate-100 shadow-sm px-6 py-4"},ne={class:"flex items-start justify-between gap-4"},de={class:"flex items-center gap-2"},ie={class:"grid grid-cols-1 xl:grid-cols-3 gap-4 flex-1 min-h-0"},ue={class:"xl:col-span-2 bg-white rounded-2xl shadow-sm border border-slate-100 flex flex-col overflow-hidden min-h-0"},ce={key:0,class:"flex flex-col items-center justify-center h-full text-slate-400"},fe={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 mt-6 w-full max-w-3xl"},xe=["onClick"],ve={class:"text-sm text-slate-700 mt-1"},pe={key:0,class:"max-w-[78%] bg-gradient-to-br from-emerald-600 to-teal-600 text-white rounded-2xl rounded-br-md px-4 py-3 shadow-sm"},me={class:"text-sm whitespace-pre-wrap leading-relaxed"},ge={key:1,class:"max-w-[88%] flex gap-3"},be={class:"bg-slate-50 border border-slate-100 rounded-2xl rounded-bl-md px-4 py-3 shadow-sm"},he={class:"text-sm text-slate-800 whitespace-pre-wrap leading-relaxed"},ye={key:0,class:"mt-2"},_e={key:1,class:"flex gap-3"},we={class:"bg-slate-50 border border-slate-100 rounded-2xl rounded-bl-md px-4 py-3 shadow-sm"},ke={class:"flex items-center gap-2"},Ce={class:"text-sm text-slate-500"},$e={class:"border-t border-slate-100 p-4 bg-white"},ze={class:"flex gap-3 items-end"},je={class:"flex-1"},Ne={class:"bg-white rounded-2xl shadow-sm border border-slate-100 flex flex-col overflow-hidden min-h-0"},Te={class:"px-5 py-4 border-b border-slate-100 flex items-center justify-between"},Ae={class:"flex-1 overflow-y-auto p-5"},Be={class:"grid grid-cols-2 gap-3"},Ie={class:"p-3 rounded-2xl bg-slate-50 border border-slate-100"},Se={class:"text-sm font-semibold text-slate-800 mt-1"},qe={class:"p-3 rounded-2xl bg-slate-50 border border-slate-100"},He={class:"text-sm font-semibold text-slate-800 mt-1"},Me={class:"flex gap-2 mt-4"},Ue={class:"mt-4"},Ve={class:"flex items-center justify-between"},Ee={key:0,class:"text-xs text-slate-400"},De={key:0,class:"mt-3 p-4 rounded-2xl border border-dashed border-slate-200 text-center"},Ke={key:1,class:"mt-3 space-y-2"},Le={class:"min-w-0 flex-1"},Fe={class:"text-xs text-slate-400"},Pe={class:"text-sm text-slate-800 mt-0.5 break-words"},Re={class:"p-5 border-t border-slate-100 bg-white"},Ge={class:"space-y-3"},Oe={key:0,class:"text-center text-slate-400 py-8"},We=["onClick"],Xe={class:"flex items-center justify-between"},Ye={class:"text-sm font-medium text-slate-700 truncate flex-1"},Ze={class:"text-xs text-slate-400 mt-1"},ss={__name:"OneClickTest",setup(Je){const A=R(),y=b(""),i=b([]),p=b(!1),m=b(!1),B=b("AI æ­£åœ¨åˆ†æ..."),g=b(null),r=b([]),$=b(!1),I=b([]),z=b(null),H=["å¸®æˆ‘æµ‹è¯•ç™»å½•åŠŸèƒ½","å¸®æˆ‘æµ‹è¯•è¯¾ç¨‹ä½œä¸šçš„æ‰€æœ‰åŠŸèƒ½","å…¨é¢æµ‹è¯•ç”¨æˆ·ç®¡ç†æ¨¡å—"],S=te(()=>r.value.filter(l=>l._checked).length);function k(){ae(()=>{z.value&&(z.value.scrollTop=z.value.scrollHeight)})}async function q(){const l=y.value.trim();if(l){i.value.push({role:"user",content:l}),y.value="",p.value=!0,B.value="AI æ­£åœ¨åˆ†ææ‚¨çš„éœ€æ±‚...",k();try{const e=await C.start(l);if(p.value=!1,e.success){g.value=e.session_id;const t=e.data;if(t.messages){const f=t.messages.filter(h=>h.role==="assistant");for(const h of f)i.value.push(h)}t.generated_cases&&t.generated_cases.length>0&&(r.value=t.generated_cases.map(f=>({...f,_checked:!0})))}else i.value.push({role:"assistant",content:`âŒ ${e.message||"å¯åŠ¨å¤±è´¥"}`})}catch(e){p.value=!1,i.value.push({role:"assistant",content:`âŒ è¯·æ±‚å¤±è´¥: ${e.message}`})}k()}}async function M(){if(!g.value)return;const l=r.value.filter(e=>e._checked).map(({_checked:e,...t})=>t);if(l.length===0){A.warning("è¯·è‡³å°‘é€‰æ‹©ä¸€æ¡ç”¨ä¾‹");return}m.value=!0,i.value.push({role:"user",content:`ç¡®è®¤æ‰§è¡Œ ${l.length} æ¡æµ‹è¯•ç”¨ä¾‹`}),k();try{const e=await C.confirm(g.value,l);if(m.value=!1,e.success&&e.data){const t=(e.data.messages||[]).filter(x=>x.role==="assistant"),f=i.value.filter(x=>x.role==="assistant").length;for(let x=f;x<t.length;x++)i.value.push(t[x]);const h=e.data.result;if(h&&h.summary){const x=h.summary;i.value.push({role:"assistant",content:`ğŸ“Š æµ‹è¯•å®Œæˆï¼
é€šè¿‡: ${x.passed}/${x.total}
å¤±è´¥: ${x.failed}/${x.total}
è€—æ—¶: ${x.duration}ç§’`})}}else i.value.push({role:"assistant",content:`âŒ ${e.message||"æ‰§è¡Œå¤±è´¥"}`})}catch(e){m.value=!1,i.value.push({role:"assistant",content:`âŒ æ‰§è¡Œå¼‚å¸¸: ${e.message}`})}k()}function U(){r.value.forEach(l=>l._checked=!0)}function V(){r.value.forEach(l=>l._checked=!1)}function E(){y.value="",i.value=[],p.value=!1,m.value=!1,B.value="AI æ­£åœ¨åˆ†æ...",g.value=null,r.value=[]}async function D(){if(g.value)try{await C.stop(g.value),p.value=!1,m.value=!1,i.value.push({role:"assistant",content:"â¹ï¸ æµ‹è¯•å·²åœæ­¢"})}catch{A.error("åœæ­¢å¤±è´¥")}}async function K(){try{const l=await C.getHistory({page:1,page_size:50});l.success&&(I.value=l.data.items||[])}catch(l){console.error("åŠ è½½å†å²å¤±è´¥",l)}}async function L(l){try{const e=await C.getSession(l);if(e.success){const t=e.data;g.value=t.id,i.value=t.messages||[],t.generated_cases&&t.generated_cases.length>0&&(r.value=t.generated_cases.map(f=>({...f,_checked:!0}))),$.value=!1,k()}}catch{A.error("åŠ è½½ä¼šè¯å¤±è´¥")}}function F(l){return{completed:"success",failed:"error",executing:"warning",cases_generated:"info"}[l]||"default"}function P(l){return{init:"åˆå§‹åŒ–",analyzing:"åˆ†æä¸­",page_scanned:"å·²æ‰«æ",cases_generated:"å·²ç”Ÿæˆ",confirmed:"å·²ç¡®è®¤",executing:"æ‰§è¡Œä¸­",completed:"å·²å®Œæˆ",failed:"å¤±è´¥"}[l]||l}return G(()=>{K()}),(l,e)=>(o(),n("div",oe,[s("div",re,[s("div",ne,[e[7]||(e[7]=O('<div class="flex items-center gap-3"><div class="w-11 h-11 rounded-2xl bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center shadow-lg"><i class="fas fa-rocket text-white text-lg"></i></div><div><h2 class="text-xl font-bold text-slate-800 leading-tight">ä¸€é”®æµ‹è¯•</h2><p class="text-xs text-slate-500 mt-1">è¾“å…¥ä¸€å¥è¯ï¼ŒAI ç”Ÿæˆç”¨ä¾‹å¹¶ä¸€é”®æ‰§è¡Œ</p><div class="flex flex-wrap gap-2 mt-3"><span class="inline-flex items-center gap-2 text-xs text-slate-500 bg-slate-50 border border-slate-200 px-3 py-1.5 rounded-full"><span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span> ç”Ÿæˆç”¨ä¾‹ â†’ é€‰æ‹©ç”¨ä¾‹ â†’ æ‰§è¡Œ </span><span class="inline-flex items-center gap-2 text-xs text-slate-500 bg-slate-50 border border-slate-200 px-3 py-1.5 rounded-full"><i class="fas fa-shield-alt text-[10px] text-emerald-600"></i> æ”¯æŒä¸­é€”åœæ­¢ </span></div></div></div>',1)),s("div",de,[u(d(_),{size:"small",quaternary:"",onClick:e[0]||(e[0]=t=>$.value=!0),class:"!rounded-xl"},{icon:a(()=>[...e[3]||(e[3]=[s("i",{class:"fas fa-history"},null,-1)])]),default:a(()=>[e[4]||(e[4]=v(" å†å²è®°å½• ",-1))]),_:1}),u(d(_),{size:"small",quaternary:"",onClick:E,class:"!rounded-xl"},{icon:a(()=>[...e[5]||(e[5]=[s("i",{class:"fas fa-broom"},null,-1)])]),default:a(()=>[e[6]||(e[6]=v(" æ¸…ç©º ",-1))]),_:1})])])]),s("div",ie,[s("div",ue,[s("div",{ref_key:"messageContainer",ref:z,class:"flex-1 overflow-y-auto px-6 py-5 space-y-4"},[i.value.length===0?(o(),n("div",ce,[e[9]||(e[9]=s("div",{class:"w-14 h-14 rounded-2xl bg-emerald-50 border border-emerald-100 flex items-center justify-center mb-4"},[s("i",{class:"fas fa-robot text-3xl text-emerald-500"})],-1)),e[10]||(e[10]=s("p",{class:"text-lg font-semibold text-slate-700"},"è¾“å…¥éœ€æ±‚ï¼Œå¼€å§‹ä¸€é”®æµ‹è¯•",-1)),e[11]||(e[11]=s("p",{class:"text-sm mt-1 text-slate-500"},"æ¯”å¦‚ï¼šæŒ‡å®šæ¨¡å— + é‡ç‚¹åŠŸèƒ½ + æœŸæœ›è¦†ç›–èŒƒå›´",-1)),s("div",fe,[(o(),n(j,null,N(H,t=>s("button",{key:t,class:"text-left p-3 rounded-2xl border border-slate-200 hover:border-emerald-300 hover:bg-emerald-50 transition-colors",onClick:f=>y.value=t},[e[8]||(e[8]=s("div",{class:"text-xs text-slate-400"},"ç¤ºä¾‹æŒ‡ä»¤",-1)),s("div",ve,c(t),1)],8,xe)),64))])])):w("",!0),(o(!0),n(j,null,N(i.value,(t,f)=>(o(),n("div",{key:f,class:W(["flex",t.role==="user"?"justify-end":"justify-start"])},[t.role==="user"?(o(),n("div",pe,[s("p",me,c(t.content),1)])):(o(),n("div",ge,[e[12]||(e[12]=s("div",{class:"w-8 h-8 rounded-full bg-gradient-to-br from-emerald-400 to-teal-500 flex items-center justify-center flex-shrink-0 mt-1 shadow-sm"},[s("i",{class:"fas fa-robot text-white text-xs"})],-1)),s("div",be,[s("p",he,c(t.content),1),t.type==="case_result"?(o(),n("div",ye,[u(d(T),{size:"tiny",type:t.status==="pass"?"success":"error",round:""},{default:a(()=>[v(c(t.status==="pass"?"é€šè¿‡":"å¤±è´¥"),1)]),_:2},1032,["type"])])):w("",!0)])]))],2))),128)),p.value?(o(),n("div",_e,[e[13]||(e[13]=s("div",{class:"w-8 h-8 rounded-full bg-gradient-to-br from-emerald-400 to-teal-500 flex items-center justify-center flex-shrink-0 shadow-sm"},[s("i",{class:"fas fa-robot text-white text-xs"})],-1)),s("div",we,[s("div",ke,[u(d(X),{size:"small"}),s("span",Ce,c(B.value),1)])])])):w("",!0)],512),s("div",$e,[s("div",ze,[s("div",je,[u(d(J),{value:y.value,"onUpdate:value":e[1]||(e[1]=t=>y.value=t),type:"textarea",placeholder:"è¾“å…¥æµ‹è¯•æŒ‡ä»¤ï¼Œå¦‚ï¼šå¸®æˆ‘æµ‹è¯•è¯¾ç¨‹ä½œä¸šçš„æ‰€æœ‰åŠŸèƒ½",autosize:{minRows:1,maxRows:4},onKeydown:Y(Z(q,["exact","prevent"]),["enter"]),disabled:p.value||m.value},null,8,["value","onKeydown","disabled"])]),u(d(_),{type:"primary",disabled:!y.value.trim()||p.value||m.value,onClick:q,class:"!rounded-xl"},{icon:a(()=>[...e[14]||(e[14]=[s("i",{class:"fas fa-paper-plane"},null,-1)])]),default:a(()=>[e[15]||(e[15]=v(" å‘é€ ",-1))]),_:1},8,["disabled"]),m.value||p.value?(o(),Q(d(_),{key:0,type:"error",ghost:"",onClick:D,class:"!rounded-xl"},{icon:a(()=>[...e[16]||(e[16]=[s("i",{class:"fas fa-stop"},null,-1)])]),default:a(()=>[e[17]||(e[17]=v(" åœæ­¢ ",-1))]),_:1})):w("",!0)])])]),s("div",Ne,[s("div",Te,[e[18]||(e[18]=s("div",{class:"flex items-center gap-2"},[s("i",{class:"fas fa-list-check text-emerald-600"}),s("span",{class:"text-sm font-semibold text-slate-800"},"ç”¨ä¾‹é€‰æ‹©ä¸æ‰§è¡Œ")],-1)),u(d(T),{size:"small",type:r.value.length?"info":"default",round:""},{default:a(()=>[v(c(r.value.length?`å·²ç”Ÿæˆ ${r.value.length}`:"æœªç”Ÿæˆ"),1)]),_:1},8,["type"])]),s("div",Ae,[s("div",Be,[s("div",Ie,[e[19]||(e[19]=s("div",{class:"text-xs text-slate-500"},"ä¼šè¯",-1)),s("div",Se,c(g.value?`#${g.value}`:"-"),1)]),s("div",qe,[e[20]||(e[20]=s("div",{class:"text-xs text-slate-500"},"å·²é€‰",-1)),s("div",He,c(r.value.length?`${S.value}/${r.value.length}`:"0/0"),1)])]),s("div",Me,[u(d(_),{size:"small",quaternary:"",onClick:U,disabled:r.value.length===0,class:"!rounded-xl"},{default:a(()=>[...e[21]||(e[21]=[v(" å…¨é€‰ ",-1)])]),_:1},8,["disabled"]),u(d(_),{size:"small",quaternary:"",onClick:V,disabled:r.value.length===0,class:"!rounded-xl"},{default:a(()=>[...e[22]||(e[22]=[v(" å–æ¶ˆå…¨é€‰ ",-1)])]),_:1},8,["disabled"])]),s("div",Ue,[s("div",Ve,[e[23]||(e[23]=s("div",{class:"text-xs text-slate-500 font-medium"},"ç”¨ä¾‹åˆ—è¡¨",-1)),r.value.length?(o(),n("span",Ee,"å‹¾é€‰åæ‰§è¡Œ")):w("",!0)]),r.value.length===0?(o(),n("div",De,[...e[24]||(e[24]=[s("div",{class:"text-sm text-slate-500"},"è¿˜æ²¡æœ‰ç”Ÿæˆç”¨ä¾‹",-1),s("div",{class:"text-xs text-slate-400 mt-1"},"åœ¨å·¦ä¾§è¾“å…¥éœ€æ±‚åï¼ŒAI ä¼šç”Ÿæˆå¯æ‰§è¡Œçš„æµ‹è¯•ç”¨ä¾‹",-1)])])):(o(),n("div",Ke,[(o(!0),n(j,null,N(r.value,(t,f)=>(o(),n("div",{key:f,class:"flex items-start gap-2 p-3 bg-white rounded-2xl border border-slate-200 hover:border-emerald-300 transition-colors"},[u(d(ee),{checked:t._checked,"onUpdate:checked":h=>t._checked=h,size:"small",class:"mt-0.5"},null,8,["checked","onUpdate:checked"]),s("div",Le,[s("div",Fe,c(f+1),1),s("div",Pe,c(t.title),1)]),u(d(T),{size:"tiny",type:t.priority==="1"?"error":t.priority==="2"?"warning":"info",round:""},{default:a(()=>[v(" P"+c(t.priority||3),1)]),_:2},1032,["type"])]))),128))]))])]),s("div",Re,[u(d(_),{type:"primary",block:"",class:"!rounded-2xl",onClick:M,disabled:!g.value||S.value===0||p.value||m.value,loading:m.value},{icon:a(()=>[...e[25]||(e[25]=[s("i",{class:"fas fa-play"},null,-1)])]),default:a(()=>[v(" ç¡®è®¤æ‰§è¡Œï¼ˆ"+c(S.value)+"ï¼‰ ",1)]),_:1},8,["disabled","loading"]),e[26]||(e[26]=s("div",{class:"text-[11px] text-slate-400 mt-2 leading-relaxed"}," æ‰§è¡Œä¼šåœ¨å·¦ä¾§è¾“å‡ºè¿‡ç¨‹ä¸ç»“æœï¼›å¤±è´¥ç”¨ä¾‹ä¼šç”Ÿæˆ BUG æŠ¥å‘Šå¹¶è§¦å‘é‚®ä»¶é€šçŸ¥ï¼ˆå¦‚åç«¯å·²å¯ç”¨ï¼‰ã€‚ ",-1))])])]),u(d(se),{show:$.value,"onUpdate:show":e[2]||(e[2]=t=>$.value=t),width:400,placement:"right"},{default:a(()=>[u(d(le),{title:"å†å²è®°å½•"},{default:a(()=>[s("div",Ge,[I.value.length===0?(o(),n("div",Oe," æš‚æ— å†å²è®°å½• ")):w("",!0),(o(!0),n(j,null,N(I.value,t=>(o(),n("div",{key:t.id,class:"p-3 bg-slate-50 rounded-xl cursor-pointer hover:bg-emerald-50 transition-colors border border-transparent hover:border-emerald-200",onClick:f=>L(t.id)},[s("div",Xe,[s("span",Ye,c(t.user_input),1),u(d(T),{size:"tiny",type:F(t.status),round:""},{default:a(()=>[v(c(P(t.status)),1)]),_:2},1032,["type"])]),s("div",Ze,c(t.created_at),1)],8,We))),128))])]),_:1})]),_:1},8,["show"])]))}};export{ss as default};
