import{e as k}from"./index-DiZwQw_Q.js";import{_ as J,u as K,j as Q,o as W,c,d as o,w as l,e as a,N as A,k as X,r as f,f as d,b as s,t as r,p as V,a1 as j,B as x,i as u,l as Y,x as Z,y as _,v as S,A as T,F as P,z as U,T as tt,s as w,q as $,P as h}from"./index-9-2YgmGC.js";const et={class:"send-mail-container"},st={class:"stats-grid mb-6"},at={class:"stat-card"},lt={class:"stat-content"},ot={class:"stat-value"},it={class:"stat-card"},rt={class:"stat-content"},nt={class:"stat-value"},ut={class:"stat-card"},dt={class:"stat-content"},ct={class:"stat-value"},ft={class:"stat-card"},vt={class:"stat-content"},pt={class:"stat-value"},_t={class:"filter-bar mb-4"},mt={key:0},yt={style:{color:"#4caf50"}},gt={style:{color:"#f44336"}},bt={class:"text-gray-600"},kt={class:"recipients-list"},xt={class:"ml-2"},wt={key:0,class:"ml-2 text-xs text-gray-400"},ht={key:1,class:"email-ids"},Nt={__name:"SendMail",setup(Dt){const m=K(),E=Q(),N=f(!1),C=f([]),v=f({total_sends:0,total_success_emails:0,total_failed_emails:0,success_rate:0}),y=f(null),g=f(null),b=f(!1),i=f(null),F=[{label:"å…¨éƒ¨",value:null},{label:"æˆåŠŸ",value:"success"},{label:"éƒ¨åˆ†æˆåŠŸ",value:"partial"},{label:"å¤±è´¥",value:"failed"}],L=[{label:"å…¨éƒ¨",value:null},{label:"æµ‹è¯•æŠ¥å‘Š",value:"report"},{label:"Bugé€šçŸ¥",value:"bug"},{label:"è‡ªå®šä¹‰",value:"custom"}],O={pageSize:10},q=[{title:"ID",key:"id",width:60},{title:"é‚®ä»¶ä¸»é¢˜",key:"subject",ellipsis:{tooltip:!0}},{title:"ç±»åž‹",key:"email_type",width:100,render(e){return I(e.email_type)}},{title:"çŠ¶æ€",key:"status",width:100,render(e){return h(S,{type:R(e.status)},{default:()=>M(e.status)})}},{title:"æ”¶ä»¶äºº",key:"total_count",width:80,render(e){return`${e.success_count}/${e.total_count}`}},{title:"å‘é€æ—¶é—´",key:"created_at",width:160,render(e){return B(e.created_at)}},{title:"æ“ä½œ",key:"actions",width:150,render(e){return h(V,{},{default:()=>[h(x,{size:"small",onClick:()=>G(e)},{default:()=>"è¯¦æƒ…"}),h(x,{size:"small",type:"error",onClick:()=>H(e)},{default:()=>"åˆ é™¤"})]})}}],z=async()=>{try{const e=await k.getStatistics();e.success&&(v.value=e.data)}catch(e){console.error("åŠ è½½ç»Ÿè®¡ä¿¡æ¯å¤±è´¥:",e)}},p=async()=>{N.value=!0;try{const e={limit:100,offset:0};y.value&&(e.status=y.value),g.value&&(e.email_type=g.value);const t=await k.getRecords(e);C.value=Array.isArray(t)?t:[]}catch(e){console.error("åŠ è½½è®°å½•å¤±è´¥:",e),m.error("åŠ è½½è®°å½•å¤±è´¥")}finally{N.value=!1}},G=async e=>{try{const t=await k.getRecordDetail(e.id);i.value=t,b.value=!0}catch(t){console.error("åŠ è½½è¯¦æƒ…å¤±è´¥:",t),m.error("åŠ è½½è¯¦æƒ…å¤±è´¥")}},H=e=>{E.warning({title:"ç¡®è®¤åˆ é™¤",content:"ç¡®å®šè¦åˆ é™¤è¿™æ¡å‘é€è®°å½•å—ï¼Ÿ",positiveText:"ç¡®å®š",negativeText:"å–æ¶ˆ",onPositiveClick:async()=>{try{(await k.deleteRecord(e.id)).success&&(m.success("åˆ é™¤æˆåŠŸ"),p(),z())}catch{m.error("åˆ é™¤å¤±è´¥")}}})},B=e=>e?new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",R=e=>({success:"success",partial:"warning",failed:"error"})[e]||"default",M=e=>({success:"æˆåŠŸ",partial:"éƒ¨åˆ†æˆåŠŸ",failed:"å¤±è´¥"})[e]||e,I=e=>({report:"æµ‹è¯•æŠ¥å‘Š",bug:"Bugé€šçŸ¥",custom:"è‡ªå®šä¹‰"})[e]||e;return W(()=>{z(),p()}),(e,t)=>(d(),c("div",et,[o(a(A),{title:"ðŸ“§ é‚®ä»¶å‘é€è®°å½•",bordered:!1},{default:l(()=>[s("div",st,[s("div",at,[t[5]||(t[5]=s("div",{class:"stat-icon",style:{background:"#e3f2fd"}},[s("i",{class:"fas fa-paper-plane",style:{color:"#2196f3"}})],-1)),s("div",lt,[s("p",ot,r(v.value.total_sends),1),t[4]||(t[4]=s("p",{class:"stat-label"},"æ€»å‘é€æ¬¡æ•°",-1))])]),s("div",it,[t[7]||(t[7]=s("div",{class:"stat-icon",style:{background:"#e8f5e9"}},[s("i",{class:"fas fa-check-circle",style:{color:"#4caf50"}})],-1)),s("div",rt,[s("p",nt,r(v.value.total_success_emails),1),t[6]||(t[6]=s("p",{class:"stat-label"},"æˆåŠŸé‚®ä»¶æ•°",-1))])]),s("div",ut,[t[9]||(t[9]=s("div",{class:"stat-icon",style:{background:"#ffebee"}},[s("i",{class:"fas fa-times-circle",style:{color:"#f44336"}})],-1)),s("div",dt,[s("p",ct,r(v.value.total_failed_emails),1),t[8]||(t[8]=s("p",{class:"stat-label"},"å¤±è´¥é‚®ä»¶æ•°",-1))])]),s("div",ft,[t[11]||(t[11]=s("div",{class:"stat-icon",style:{background:"#fff3e0"}},[s("i",{class:"fas fa-percentage",style:{color:"#ff9800"}})],-1)),s("div",vt,[s("p",pt,r(v.value.success_rate)+"%",1),t[10]||(t[10]=s("p",{class:"stat-label"},"æˆåŠŸçŽ‡",-1))])])]),s("div",_t,[o(a(V),null,{default:l(()=>[o(a(j),{value:y.value,"onUpdate:value":[t[0]||(t[0]=n=>y.value=n),p],options:F,placeholder:"çŠ¶æ€ç­›é€‰",style:{width:"150px"},clearable:""},null,8,["value"]),o(a(j),{value:g.value,"onUpdate:value":[t[1]||(t[1]=n=>g.value=n),p],options:L,placeholder:"ç±»åž‹ç­›é€‰",style:{width:"150px"},clearable:""},null,8,["value"]),o(a(x),{onClick:p,type:"primary"},{icon:l(()=>[...t[12]||(t[12]=[s("i",{class:"fas fa-sync-alt"},null,-1)])]),default:l(()=>[t[13]||(t[13]=u(" åˆ·æ–° ",-1))]),_:1})]),_:1})]),o(a(Y),{columns:q,data:C.value,loading:N.value,pagination:O,bordered:!1},null,8,["data","loading"])]),_:1}),o(a(X),{show:b.value,"onUpdate:show":t[3]||(t[3]=n=>b.value=n)},{default:l(()=>[o(a(A),{style:{width:"700px"},title:"é‚®ä»¶å‘é€è¯¦æƒ…",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{"header-extra":l(()=>[o(a(x),{text:"",onClick:t[2]||(t[2]=n=>b.value=!1)},{icon:l(()=>[...t[14]||(t[14]=[s("i",{class:"fas fa-times"},null,-1)])]),_:1})]),default:l(()=>[i.value?(d(),c("div",mt,[o(a(Z),{column:2,bordered:""},{default:l(()=>[o(a(_),{label:"é‚®ä»¶ä¸»é¢˜"},{default:l(()=>[u(r(i.value.subject),1)]),_:1}),o(a(_),{label:"å‘é€çŠ¶æ€"},{default:l(()=>[o(a(S),{type:R(i.value.status)},{default:l(()=>[u(r(M(i.value.status)),1)]),_:1},8,["type"])]),_:1}),o(a(_),{label:"é‚®ä»¶ç±»åž‹"},{default:l(()=>[u(r(I(i.value.email_type)),1)]),_:1}),o(a(_),{label:"å‘é€æ—¶é—´"},{default:l(()=>[u(r(B(i.value.created_at)),1)]),_:1}),o(a(_),{label:"æˆåŠŸ/å¤±è´¥/æ€»æ•°"},{default:l(()=>[s("span",yt,r(i.value.success_count),1),t[15]||(t[15]=u(" / ",-1)),s("span",gt,r(i.value.failed_count),1),u(" / "+r(i.value.total_count),1)]),_:1})]),_:1}),o(a(T),null,{default:l(()=>[...t[16]||(t[16]=[u("å†…å®¹æ‘˜è¦",-1)])]),_:1}),s("p",bt,r(i.value.content_summary||"æ— "),1),o(a(T),null,{default:l(()=>[...t[17]||(t[17]=[u("æ”¶ä»¶äººåˆ—è¡¨",-1)])]),_:1}),s("div",kt,[(d(!0),c(P,null,U(i.value.recipients,(n,D)=>(d(),c("div",{key:D,class:"recipient-item"},[s("i",{class:tt(["fas",n.status==="success"?"fa-check-circle text-green-500":n.status==="skipped"?"fa-exclamation-triangle text-orange-500":"fa-times-circle text-red-500"])},null,2),s("span",xt,r(n.name)+" ("+r(n.email)+")",1),n.error?(d(),c("span",wt," - "+r(n.error),1)):w("",!0)]))),128))]),i.value.email_ids&&i.value.email_ids.length>0?(d(),$(a(T),{key:0},{default:l(()=>[...t[18]||(t[18]=[u(" Resend Email IDs ",-1)])]),_:1})):w("",!0),i.value.email_ids&&i.value.email_ids.length>0?(d(),c("div",ht,[(d(!0),c(P,null,U(i.value.email_ids,(n,D)=>(d(),$(a(S),{key:D,size:"small",class:"mr-2 mb-2"},{default:l(()=>[u(r(n),1)]),_:2},1024))),128))])):w("",!0)])):w("",!0)]),_:1})]),_:1},8,["show"])]))}},Ct=J(Nt,[["__scopeId","data-v-e86704de"]]);export{Ct as default};
