import{O as M,ac as A,U as m,r as o}from"./index-9-2YgmGC.js";function x(w={}){const{fetchFunction:z,pageSize:L=20,autoLoad:P=!0,filters:i=M({}),debounceDelay:p=300}=w,e=o([]),t=o(!1),u=o(1),r=o(L),n=o(0),v=o(!0),h=m(()=>Math.ceil(n.value/r.value)),S=m(()=>!t.value&&e.value.length===0);let f=null;const l=async(a=!1)=>{if(!t.value){t.value=!0;try{const c={limit:r.value,offset:a?e.value.length:(u.value-1)*r.value,...i},s=await z(c);if(s.success||Array.isArray(s)){const y=s.data||s;a?e.value=[...e.value,...y]:e.value=y,n.value=s.total||e.value.length,v.value=e.value.length<n.value}else throw new Error(s.message||"加载失败")}catch(c){throw console.error("[useLazyLoad] 加载数据失败:",c),c}finally{t.value=!1}}},T=async()=>{!v.value||t.value||await l(!0)},d=async()=>{u.value=1,await l(!1)},b=async a=>{a<1||a>h.value||(u.value=a,await l(!1))},D=async a=>{r.value=a,u.value=1,await l(!1)},g=()=>{f&&clearTimeout(f),f=setTimeout(()=>{d()},p)};return i&&A(()=>({...i}),()=>{g()},{deep:!0}),P&&l(),{data:e,loading:t,currentPage:u,pageSize:r,total:n,hasMore:v,isEmpty:S,totalPages:h,loadData:l,loadMore:T,refresh:d,goToPage:b,changePageSize:D,debouncedRefresh:g}}export{x as u};
